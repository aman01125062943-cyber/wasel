[
  {
    "projectId": "ffe7df93-3928-48a3-a9c8-66fcc20c6afb",
    "testId": "ee886db9-26f1-4852-8104-032942510c58",
    "userId": "f4c8a4b8-a0f1-703c-2682-84d54668017e",
    "title": "TC015-Scheduled Delivery of Daily Adhkar and Hadiths",
    "description": "Ensure scheduled background jobs send Islamic content (morning and evening adhkar, daily hadiths) via WhatsApp on configured times.",
    "code": "import asyncio\nfrom playwright import async_api\nfrom playwright.async_api import expect\n\nasync def run_test():\n    pw = None\n    browser = None\n    context = None\n    \n    try:\n        # Start a Playwright session in asynchronous mode\n        pw = await async_api.async_playwright().start()\n        \n        # Launch a Chromium browser in headless mode with custom arguments\n        browser = await pw.chromium.launch(\n            headless=True,\n            args=[\n                \"--window-size=1280,720\",         # Set the browser window size\n                \"--disable-dev-shm-usage\",        # Avoid using /dev/shm which can cause issues in containers\n                \"--ipc=host\",                     # Use host-level IPC for better stability\n                \"--single-process\"                # Run the browser in a single process mode\n            ],\n        )\n        \n        # Create a new browser context (like an incognito window)\n        context = await browser.new_context()\n        context.set_default_timeout(5000)\n        \n        # Open a new page in the browser context\n        page = await context.new_page()\n        \n        # Navigate to your target URL and wait until the network request is committed\n        await page.goto(\"http://localhost:3001\", wait_until=\"commit\", timeout=10000)\n        \n        # Wait for the main page to reach DOMContentLoaded state (optional for stability)\n        try:\n            await page.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n        except async_api.Error:\n            pass\n        \n        # Iterate through all iframes and wait for them to load as well\n        for frame in page.frames:\n            try:\n                await frame.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n            except async_api.Error:\n                pass\n        \n        # Interact with the page elements to simulate user flow\n        # -> Log in to the admin panel to verify the scheduler service is running and simulate message sending.\n        frame = context.pages[-1]\n        # Click on 'دخول' (Login) to access the login page for admin or user authentication\n        elem = frame.locator('xpath=html/body/header/div/nav/a[4]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Input username and password, then submit login form.\n        frame = context.pages[-1]\n        # Input username/email for login\n        elem = frame.locator('xpath=html/body/div/form/div/input').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('aman01125062943@gmail.com')\n        \n\n        frame = context.pages[-1]\n        # Input password for login\n        elem = frame.locator('xpath=html/body/div/form/div[2]/input').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('1994')\n        \n\n        frame = context.pages[-1]\n        # Click login button to submit credentials\n        elem = frame.locator('xpath=html/body/div/form/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Navigate to 'سجل النشاط' (Activity Log) to check audit logs for subscription edit entries.\n        frame = context.pages[-1]\n        # Click on 'سجل النشاط' (Activity Log) to view audit logs\n        elem = frame.locator('xpath=html/body/div[2]/aside/nav/div[7]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Navigate to 'التذكيرات الإسلامية' (Islamic Reminders) to verify scheduler service status and simulate message sending.\n        frame = context.pages[-1]\n        # Click on 'التذكيرات الإسلامية' (Islamic Reminders) tab to check scheduler service and simulate message sending\n        elem = frame.locator('xpath=html/body/div[2]/aside/nav/div[8]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Click on 'الأذكار والمحتوى' (Adhkar and Content) to check and simulate adhkar and hadith message sending.\n        frame = context.pages[-1]\n        # Click on 'الأذكار والمحتوى' (Adhkar and Content) tab to access adhkar and hadith content settings and test options\n        elem = frame.locator('xpath=html/body/div[2]/main/div/button[3]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Simulate sending morning adhkar by clicking the 'إرسال الآن' (Send Now) button for morning adhkar.\n        frame = context.pages[-1]\n        # Click 'إرسال الآن' button for morning adhkar to simulate sending the morning adhkar message now\n        elem = frame.locator('xpath=html/body/div[2]/main/div[2]/div[2]/div[3]/div/div[3]/div[2]/div/div[2]/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Close the success dialog and simulate sending evening adhkar message by clicking the send button for evening adhkar.\n        frame = context.pages[-1]\n        # Click OK button to close the success confirmation dialog\n        elem = frame.locator('xpath=html/body/div[9]/div/div[6]/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Simulate sending the daily hadith message by clicking the 'إرسال الآن' button for Islamic varieties (daily hadith) at 9:00 PM.\n        frame = context.pages[-1]\n        # Click 'إرسال الآن' button for Islamic varieties (daily hadith) to simulate sending the daily hadith message now\n        elem = frame.locator('xpath=html/body/div[2]/main/div[2]/div[2]/div[3]/div/div[4]/div[2]/div[2]/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Close the success confirmation dialog and verify audit logs for subscription edit entries and message sending logs.\n        frame = context.pages[-1]\n        # Click OK button to close the success confirmation dialog\n        elem = frame.locator('xpath=html/body/div[9]/div/div[6]/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Click on 'سجل النشاط' (Activity Log) to verify audit logs for subscription edit entries and message sending logs.\n        frame = context.pages[-1]\n        # Click on 'سجل النشاط' (Activity Log) to view audit logs\n        elem = frame.locator('xpath=html/body/div[2]/aside/nav/div[6]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Scroll down the audit log page to load more entries and search for subscription edit or message sending logs.\n        await page.mouse.wheel(0, 1000)\n        \n\n        frame = context.pages[-1]\n        # Click تحديث (Refresh) button to reload audit logs\n        elem = frame.locator('xpath=html/body/div[2]/main/div[6]/div/button').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Navigate to 'التذكيرات الإسلامية' (Islamic Reminders) to verify scheduler service status and check for any manual subscription edits or settings that might trigger audit logs.\n        frame = context.pages[-1]\n        # Click on 'التذكيرات الإسلامية' (Islamic Reminders) tab to verify scheduler service status and subscription settings\n        elem = frame.locator('xpath=html/body/div[2]/aside/nav/div[8]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Click on 'الإعدادات' (Settings) to check scheduler service status and subscription edit options that might affect audit logs.\n        frame = context.pages[-1]\n        # Click on 'الإعدادات' (Settings) tab to check scheduler service status and subscription edit options\n        elem = frame.locator('xpath=html/body/div[2]/aside/nav/div[9]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # -> Navigate to 'النظام' (System) tab to check scheduler service status and logs related to background jobs.\n        frame = context.pages[-1]\n        # Click on 'النظام' (System) tab to check scheduler service status and background job logs\n        elem = frame.locator('xpath=html/body/div/main/div[2]/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n\n        # --> Assertions to verify final state\n        frame = context.pages[-1]\n        try:\n            await expect(frame.locator('text=Scheduler Service Operational').first).to_be_visible(timeout=1000)\n        except AssertionError:\n            raise AssertionError(\"Test case failed: Scheduled background jobs for sending Islamic content via WhatsApp did not execute successfully as per the test plan. Audit logs or message sending confirmation missing.\")\n        await asyncio.sleep(5)\n    \n    finally:\n        if context:\n            await context.close()\n        if browser:\n            await browser.close()\n        if pw:\n            await pw.stop()\n            \nasyncio.run(run_test())\n    ",
    "testStatus": "FAILED",
    "testError": "The task to ensure scheduled background jobs send Islamic content via WhatsApp was partially completed. We successfully logged into the admin panel, simulated sending morning adhkar, evening adhkar, and daily hadith messages with confirmation of successful sending. However, audit logs did not show subscription edit or message sending entries as expected, even after refreshing and scrolling. Additionally, the scheduler service status could not be verified through the UI due to the absence of a system or scheduler status tab. Therefore, full verification of the scheduler service and audit logging could not be completed. Further backend access or developer support is needed to confirm scheduler operation and audit log functionality.\nBrowser Console Logs:\n[ERROR] Error loading sessions: TypeError: Failed to fetch\n    at loadSessions (http://localhost:3001/dashboard?tab=logs:4054:35) (at http://localhost:3001/dashboard?tab=logs:4128:24)",
    "testType": "FRONTEND",
    "createFrom": "mcp",
    "testVisualization": "https://testsprite-videos.s3.us-east-1.amazonaws.com/f4c8a4b8-a0f1-703c-2682-84d54668017e/1768670560408174//tmp/test_task/result.webm",
    "created": "2026-01-17T17:13:46.024Z",
    "modified": "2026-01-17T17:22:40.588Z"
  }
]
